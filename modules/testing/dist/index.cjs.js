"use strict";function functor(t,r){for(var e in r)t[e]=r[e];return t}function prepareTest(t,r,e){void 0===e&&(e={state:{}}),e&&e.handlers&&_reactMvi_core.registerHandlers(e.handlers);var n={state:e.state,__intent:null},o=new _reactMvi_core.Provisioning(n,t,r,e.services||{},function(t){return new Mocker(t,e.state)});return o.prepare(),{store:o.getStores()[0],stores:o.getStores(),mock:new MockManipulator(o.getIntentInstance())}}Object.defineProperty(exports,"__esModule",{value:!0});var _reactMvi_core=require("@react-mvi/core"),rxjs_Rx=require("rxjs/Rx"),_this=void 0,graceful=functor(function(t,r,e){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var i;try{t.apply(_this,n)}catch(t){i=t}finally{e&&e(),r(i)}}},{run:function(t,r,e){return graceful(t,r,e)()}}),nothing=function(t,r){return function(){return r&&r(),t()}},stopOnError=functor(function(t,r,e){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];try{return t.apply(_this,n)}catch(t){e&&e(),r(t)}}},{run:function(t,r,e){return stopOnError(t,r,e)()}}),Joiner=function(){function t(t,r){this.time=t,this.cb=r,this.current=0}return t.prototype.notify=function(){++this.current===this.time&&this.cb()},t}(),__assign=Object.assign||function(t){for(var r,e=1,n=arguments.length;e<n;e++){r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},sym=function(t){return"function"==typeof Symbol?Symbol(t):"@@"+t},STATE_SYM=sym("ReactMVIMockedIntentState"),SUBJECT_SYM=sym("ReactMVIMockedIntentSubject"),BUILTINS=function(){for(var t=Object.getOwnPropertyNames(Object.prototype),r=Object.create(null),e=0,n=t.length;e<n;e++)r[t[e]]=!0;return r.constructor=!0,r}(),Mocker=function(){function t(r,e){var n=this;this[SUBJECT_SYM]={},this[STATE_SYM]=e;for(var o=r;o&&o!==Object.prototype;)Object.getOwnPropertyNames(o).forEach(function(r){if(!n[r]&&!BUILTINS[r]){var e=Object.getOwnPropertyDescriptor(o,r);if(e)if("function"==typeof e.get){var i=__assign({},e);i.get=t.proxify(n,r),Object.defineProperty(n,r,i)}else"function"==typeof e.value&&(n[r]=t.proxify(n,r))}}),o=o.__proto__}return t.proxify=function(t,r){return t[SUBJECT_SYM][r]=new rxjs_Rx.Subject,function(){return t[SUBJECT_SYM][r].share()}},t}(),MockManipulator=function(){function t(t){this.mocker=t}return t.prototype.send=function(r,e){void 0===e&&(e={}),t.send(this.mocker,r,e)},t.send=function(t,r,e){if(void 0===e&&(e={}),!t[SUBJECT_SYM][r])throw new Error("$[name} is not valid property name.");t[SUBJECT_SYM][r].next({data:e,state:t[STATE_SYM]})},t}();exports.graceful=graceful,exports.nothing=nothing,exports.stopOnError=stopOnError,exports.Joiner=Joiner,exports.prepareTest=prepareTest,exports.Mocker=Mocker,exports.MockManipulator=MockManipulator;
