var ReactMVI=function(t,e,n,r){"use strict";function o(t){return void 0!==t&&null!==t}function i(t,e){return j({},t,e)}function s(t,e){for(var n in e)t[n]=e[n];return t}function c(t,e){var n={},r="string"==typeof e?[e]:e;for(var o in t)-1===r.indexOf(o)&&(n[o]=t[o]);return n}function p(t,e){for(var n in t||{})e(t[n],n,t)}function u(t){return"Object"===w(t)}function a(t){return"Array"===w(t)}function l(t,e){if(a(t))return t.filter(e);var n=[];for(var r in t||{})e(t[r],r,t)&&n.push(t[r]);return n}function h(t,e){if(a(t))return t.map(e);var n=[];for(var r in t||{})n.push(e(t[r],r,t));return n}function f(t,e){if(a(t))return t.some(e);if(u(t))for(var n in t||{})if(e(t[n],n,t))return!0;return!1}function b(t,e){if(a(t))return t.every(e);if(u(t))for(var n in t||{})if(!e(t[n],n,t))return!1;return!0}function d(t,e){var n={};for(var r in t||{})n[r]=e(t[r],r,t);return n}function v(t){return u(t)?j({},t):a(t)?t.slice():t}function y(t){return"function"==typeof Symbol?Symbol(t):t}function m(){return P}function g(t){var e=new N;return e.collect(t),e.mapObservablesToValue()}function O(t){var e=function(e,n){t.push(e,n)};return e.callback=function(e,n){return t.callback(e,n)},e}var j=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},_=/\[object ([^\]]+)\]/,w=function(t){return t?Object.prototype.toString.call(t).match(_)[1]:"null"},S=function(){function t(t,e,n,r,o){this.method=t,this.context=e,this.args=n,this.contextName=r,this.propertyKey=o}return t.prototype.proceed=function(){return this.method.apply(this.context,this.args)},t.prototype.getArguments=function(){return this.args},t.prototype.getContext=function(){return this.context},t.prototype.getInstanceName=function(){return this.contextName},t.prototype.getPropertyName=function(){return this.propertyKey},t.prototype.getFullQualifiedName=function(){return this.getInstanceName()+"."+this.getPropertyName()},t}(),C=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},P={},x=function(){function t(t){this.streamCollection=t}return t.prototype.for=function(t){return this.streamCollection.hasWithoutGlobal(t)?this.streamCollection.getWithoutGlobal(t):this.streamCollection.add(t)},t}(),E=function(){function t(t){void 0===t&&(t={}),this.subjectMap=t}return t.prototype.hasWithoutGlobal=function(t){return!!this.subjectMap[t]},t.prototype.has=function(t){var e=t.split("::"),n=e.length>1?"*::"+e[1]:null;return!!this.subjectMap[t]||!!n&&!!this.subjectMap[n]},t.prototype.getWithoutGlobal=function(t){return this.subjectMap[t]?this.subjectMap[t]:null},t.prototype.get=function(t){var e=[],n=t.split("::"),r=n.length>1?"*::"+n[1]:null,o=r&&this.subjectMap[r]?this.subjectMap[r]:null;return this.subjectMap[t]&&e.push(this.subjectMap[t]),o&&e.push(o),e},t.prototype.add=function(t){return this.subjectMap[t]=new r.Subject},t}(),I=function(){function t(t,e){void 0===t&&(t={}),void 0===e&&(e={});var n=this;this.store=new E,this.handlerResponse=new x(this.store),p(t,function(t,r){var o=e[r];if(!(o=a(o)?o:[o]))throw new Error("Cut point "+r+" does not exists");o.forEach(function(e){if("function"!=typeof n[e])throw new Error("Advice only applyable to Function.");var r=n[e];n[e]=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var s=new S(function(){return r.apply(n,o)},n,o,n.constructor.name,e);return t.invoke?t.invoke(s):t(s)}})})}return t.prototype.setState=function(t){this.state=t},Object.defineProperty(t.prototype,"response",{get:function(){return this.handlerResponse},enumerable:!0,configurable:!0}),t.prototype.callback=function(t,e){var n=this;return function(t,r){return n.push(t,void 0!==e?e:r)}},t}(),T=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),M=function(t){function e(e){var n=t.call(this)||this;return n.history=[],n.children=[],n.prepare(e),n}return T(e,t),e.prototype.addChild=function(t){this.children.push(t)},e.prototype.removeChild=function(t){var e=this.children.indexOf(t);e>-1&&this.children.splice(e,1)},e.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),this.children=[],this.parent=null},e.prototype.prepare=function(t){this.parent=t,this.parent&&this.parent.addChild(this)},e.prototype.subscribe=function(t){return new r.Subscription},e.prototype.push=function(t,e){var n=this;if("RETRY"!==t){var r=this.findSubjects(t);if(r.length){var o=function(){return r.forEach(function(t){return t.next({data:e,state:n.state})})};return this.history.push(o),this.history.length>10&&this.history.shift(),o(),Promise.resolve()}}else{var i=this.history[e||this.history.length-1];i&&i()}},e.prototype.getStreamStore=function(){return this.store},e.prototype.callback=function(t,e){var n=this;return function(r){return n.push(t,o(e)?e:r)}},e.prototype.findSubjects=function(t){var e=this.store.get(t);return this.parent&&(e=e.concat(this.findParentSubjects(t,!1))),this.children.length&&(e=e.concat(this.findChildrenSubjects(t,!1))),e},e.prototype.findParentSubjects=function(t,e){void 0===e&&(e=!0);var n=e?this.store.get(t):[];return this.parent?n.concat(this.parent.findParentSubjects(t)):n},e.prototype.findChildrenSubjects=function(t,e){void 0===e&&(e=!0);var n=e?this.store.get(t):[];return this.children.length?this.children.reduce(function(e,r){return n.concat(r.findChildrenSubjects(t))},n):n},e}(I),A=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},N=function(){function t(){this.observables=[],this.doNotCollectObservables=!1,this.currentIndex=0,this.id=Date.now()}return t.prototype.push=function(t){this.doNotCollectObservables?this.observables[this.currentIndex++].context=t.context:this.observables.push(t)},t.prototype.mapObservablesToValue=function(){var t=this;return this.observables.length?r.Observable.combineLatest.apply(r.Observable,this.observables.map(function(t){var e=t.value,n={},r=n;return e.subscribe(function(t){return r=t}).unsubscribe(),r===n?e.startWith(null):e})).map(function(e){e.forEach(function(e,n){var r=t.observables[n];r.context[r.key]=e});var n=t.id=Date.now(),r=!1;return"function"==typeof Proxy?new Proxy(t.clone,{get:function(e,o){return"persist"===o?function(){r=!0,t.collect(t.templateObject)}:(r||n===t.id||console.warn(new Error("State object is reused for performance.\nIf you want to use state object after updated, call persist().").stack),e[o])}}):Object.defineProperty(t.clone,"persist",{value:function(){t.collect(t.templateObject)},configurable:!0,enumerable:!1,writable:!0})}):r.Observable.of(this.templateObject)},t.prototype.collect=function(t){if(this.templateObject=t,a(t))this.clone=t.slice();else{if(!u(t)||Object.getPrototypeOf(t)!==Object.prototype)throw new Error("Invalid object passed to combineTemplate");this.clone=A({},t)}this.doCollectObservable(t,this.clone),this.doNotCollectObservables=!0,this.currentIndex=0},t.prototype.doCollectObservable=function(t,e){if(a(t))for(var n=0,r=t.length;n<r;n++)this.doFindObservable(t,n,e);else{if(!u(t)||Object.getPrototypeOf(t)!==Object.prototype)throw new Error("Invalid object passed to combineTemplate");for(var o in t)this.doFindObservable(t,o,e)}},t.prototype.doFindObservable=function(t,e,n){var o=t[e];o instanceof r.Observable?(this.push({context:n,key:e,value:o}),n[e]=o):a(o)?(n[e]=o.slice(),this.doCollectObservable(t[e],n[e])):u(o)&&Object.getPrototypeOf(o)===Object.prototype?(n[e]=A({},o),this.doCollectObservable(t[e],n[e])):n[e]=o},t}(),R=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},k=function(){function t(t,e,n){this.intent=t,this.stores=e,this.service=n,this.storeInstances=[]}return t.prototype.initialize=function(){var t=this;return this.stores.reduce(function(e,n){var r=new n(t.intent,t.service),o=r.initialize();t.storeInstances.push(r);for(var i in o)e[i]?e[i]=R({},e[i],o[i]):e[i]=o[i];return e},{view:{}})},t.prototype.getStores=function(){return this.storeInstances},t}(),W=function(){function t(t,e,n,r,o){void 0===o&&(o=function(t){return t}),this.context=t,this.service=r,this.intentAdvice=o,this.isDisposed=!1,this.handlerSubscriptions=[],this.cache=null,this.IntentClass=e;this.storeConstructors=a(n)?n:[n]}return t.prototype.dispose=function(t){void 0===t&&(t=!0),this.isDisposed=!0,this.subscription.unsubscribe(),this.subscription=null,this.intent.dispose(),this.handlerSubscriptions.forEach(function(t){return t.unsubscribe()}),t&&(this.cache=null)},t.prototype.prepare=function(){var t=this;if(this.isDisposed?this.intent.prepare(this.context.__intent):this.intent||(this.intent=new M(this.context.__intent)),!this.cache){this.cache={};var e=this.cache.intentInstance=this.intentAdvice(new this.IntentClass(R({intent:this.intent.response},d(m(),function(t){return t.response})))),n=this.cache.storeGroup=new k(e,this.storeConstructors,this.service);this.cache.intentHandler=O(this.intent);this.cache.storeState=n.initialize(),this.cache.stores=n.getStores()}if(this.isDisposed||!this.subscription){var r=R({},this.cache.storeState);if(this.subscribeHandler(this.cache.storeState),this.context)for(var o in this.context.state)r[o]&&(r[o]=R({},r[o],this.context.state[o]));this.subscription=g(r).subscribe(function(e){t.intent.setState(e),p(m(),function(t){return t.setState(e)})})}this.isDisposed=!1},t.prototype.getStores=function(){return this.cache.storeGroup.getStores()},t.prototype.getState=function(){return this.cache.storeState},t.prototype.getIntentHandler=function(){return this.cache.intentHandler},t.prototype.getIntentInstance=function(){return this.cache.intentInstance},t.prototype.getIntent=function(){return this.intent},t.prototype.subscribeHandler=function(t){var e=m();for(var n in e)this.handlerSubscriptions.push(e[n].subscribe(t))},t}(),D=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),H=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},V=function(t){function r(n,o){var i=t.call(this,n,o)||this;i.provisioning=new W(i.context,i.props.intent,i.props.store,i.props.service);var s=i,c=s.provisioning,p=s.context;return i.ProviderComponent=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return D(e,t),e.prototype.render=function(){return this.props.children},e.prototype.getChildContext=function(){return{intent:c.getIntentHandler(),state:c.getState(),parent:p,__intent:c.getIntent()}},Object.defineProperty(e,"childContextTypes",{get:function(){return r.contextTypes},enumerable:!0,configurable:!0}),e}(e.Component),i}return D(r,t),r.prototype.render=function(){return e.createElement(this.ProviderComponent,null,e.cloneElement(this.props.children,this.childrenProps))},r.prototype.componentWillUnmount=function(){this.provisioning.dispose(!this.props.useCache)},r.prototype.componentWillMount=function(){this.provisioning.prepare(),this.childrenProps=H({},c(this.props,["store","intent","service","children"]),this.provisioning.getState().view||{})},r.prototype.componentWillReceiveProps=function(t){this.childrenProps=H({},c(t,["store","intent","service","children"]),this.provisioning.getState().view||{})},r.contextTypes={intent:n.any,state:n.any,parent:n.any,__intent:n.any},r}(e.Component),G=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),F=window.process&&window.process.env?window.process:{env:{NODE_ENV:"debug"}},U=e.createElement("div",{}).$$typeof,$="function"==typeof Symbol?Symbol("@@ReactMviSubscriber"):"@@ReactMviSubscriber",L=function(){function t(t,e){this.updater=t,this._observable=e}return t.prototype.observable=function(){var t=this;return this._observable.map(function(e){return{value:e,binding:t}})},t.prototype.update=function(t){this.updater(t)},t}(),z=function(t){return t.children},B=function(t){function n(n,r){var o=t.call(this,n,r)||this;return o.bindings=[],o.observableList=[],o.mutableTree=null,o.hasObservable=!1,o.hasObservable=o.areThereObservableInChildren(e.createElement(z,null,o.props.children)),o.state={vdom:o.hasObservable?null:o.props.children},o}return G(n,t),n.prototype.render=function(){return this.state.vdom},n.prototype.componentWillMount=function(){this.hasObservable&&(this.mutableTree=this.cloneChildren(e.createElement(z,null,this.props.children),null,null),this.subscribeAll())},n.prototype.componentWillReceiveProps=function(t){this.disposeAll(),this.hasObservable=this.areThereObservableInChildren(e.createElement(z,null,t.children)),this.hasObservable?(this.mutableTree=this.cloneChildren(e.createElement(z,null,t.children),null,null),this.subscribeAll()):this.setState({vdom:t.children})},n.prototype.subscribeAll=function(){var t=this;if(this.bindings.length>0){var e=this.bindings.map(function(t){return t.observable()});this.subscription=r.Observable.combineLatest.apply(r.Observable,e).subscribe(function(e){e.forEach(function(t){var e=t.value;return t.binding.update(e)}),t.setState({vdom:t.createMutableElement(t.mutableTree)})})}else this.setState({vdom:this.props.children})},n.prototype.componentWillUnmount=function(){this.disposeAll()},n.prototype.disposeAll=function(){this.subscription&&this.subscription.unsubscribe(),this.subscription=null,this.bindings=[]},n.prototype.updateChildren=function(t,n,r){t.props.children&&a(t.props.children)?(a(n)?t.props.children=t.props.children.slice(0,r).concat(n):t.props.children[r]=n,"debug"===F.env.NODE_ENV&&e.createElement.apply(e,[t.type,t.props].concat(t.props.children))):(t.props.children=n,"debug"===F.env.NODE_ENV&&e.createElement(t.type,t.props,t.props.children))},n.prototype.createMutableElement=function(t){return{$$typeof:U,type:t.type,props:v(t.props),ref:t.ref,key:t.key,_owner:t._owner}},n.prototype.areThereObservableInChildren=function(t,e){var n=this;if(void 0===e&&(e=0),t instanceof r.Observable)return!0;var i=l(t.props&&t.props.children?a(t.props.children)?t.props.children:[t.props.children]:[],function(t){return o(t)}),s=t.props;return i.some(function(t,o){return t instanceof r.Observable||(!n.props.ignoreSubtree||1!==e)&&n.areThereObservableInChildren(t,e+1)})||f(c(s,"children"),function(t,e){return t instanceof r.Observable})},n.prototype.cloneChildren=function(t,n,i,s){var u=this;void 0===s&&(s=0);var f=this.createMutableElement(t);if(p(c(f.props,"children"),function(t,e){t instanceof r.Observable&&u.bindings.push(new L(function(t){f.props[e]=t,u.updateElement(n,f,i)},t))}),this.props.ignoreSubtree&&1===s)return f;var b=h(l(f.props.children?a(f.props.children)?f.props.children:[f.props.children]:[],function(t){return o(t)}),function(t,o){if(t instanceof r.Observable)u.bindings.push(new L(function(t){u.updateChildren(f,t,o),u.updateElement(n,f,i)},t));else if(e.isValidElement(t)&&!u.isSubscriber(t))return u.cloneChildren(t,f,o,s+1);return t});return f.props.children&&(a(f.props.children)?f.props.children=b:f.props.children=b[0]),f},n.prototype.updateElement=function(t,e,n){t?this.updateChildren(t,this.createMutableElement(e),n):this.mutableTree=this.createMutableElement(e)},n.prototype.isSubscriber=function(t){return t.type&&(t.type===n||t.type[$])},n}(e.Component),K=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Y=function(t){var n=(r=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return K(r,n),r.prototype.render=function(){return e.createElement(B,{ignoreSubtree:this.props.ignoreSubtree},e.createElement(t,i(c(this.props,["ref","ignoreSubtree"]),{ref:"element"})))},r}(e.Component),r.displayName=""+t.charAt(0).toUpperCase()+t.slice(1),r);return n[$]=!0,n;var r},q={};"a abbr address area article aside audio b base bdi bdo big blockquote body br\nbutton canvas caption cite code col colgroup data datalist dd del details dfn\ndialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5\nh6 head header hgroup hr html i iframe img input ins kbd keygen label legend li\nlink main map mark menu menuitem meta meter nav noscript object ol optgroup\noption output p param picture pre progress q rp rt ruby s samp script section\nselect small source span strong style sub summary sup table tbody td textarea\ntfoot th thead time title tr track u ul var video wbr".replace(/\n/g," ").split(" ").forEach(function(t){var e=""+t.charAt(0).toUpperCase()+t.slice(1);q[e]=Y(t)});var Q=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),X=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},J={mapStateToProps:void 0,mapIntentToProps:void 0},Z={intent:n.any,state:n.any,parent:n.any},tt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),et=y("@@reactMVIStore");return t.Provider=V,t.SUBSCRIBER_MARK=$,t.Subscriber=B,t.Tags=q,t.CONTEXT_TYPES=Z,t.connect=function(t){void 0===t&&(t=J);var n=t.mapStateToProps,r=void 0===n?function(t){return t}:n,o=t.mapIntentToProps,i=void 0===o?function(t){return{}}:o;return function(t){t.contextTypes=Z;var n=(t.name||t.displayName||"AnonymousComponent")+"$EnhancedReactMVIContextConnectorComponent";return o=function(n){function o(t,e){var o=n.call(this,t,e)||this;return o.mappedProps=X({},r(o.props),i(o.context.intent)),o}return Q(o,n),o.prototype.render=function(){return e.createElement(t,X({},this.mappedProps))},o.prototype.componentWillReceiveProps=function(t){this.mappedProps=X({},r(t),i(this.context.intent))},o.prototype.getChildContext=function(){return{intent:this.context.intent,state:this.context.state,parent:this.context.parent}},Object.defineProperty(o,"childContextTypes",{get:function(){return Z},enumerable:!0,configurable:!0}),o}(e.Component),o.displayName=n,o.contextTypes=Z,o;var o}},t.view=function(t,n){return r=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return tt(r,e),r.prototype.render=function(){return t(this.props,this.context)},Object.defineProperty(r,"displayName",{get:function(){return n||"StatelessView"},enumerable:!0,configurable:!0}),r}(e.Component),r.contextTypes=Z,r;var r},t.context=function(t){return t.contextTypes=Z,t},t.STORE_SYMBOL=et,t.store=function(t){function e(e,n){this.intent=e,n&&s(this,n),t.call(this,e)}return e[et]=!0,e.prototype=t.prototype,e},t.getHandlers=m,t.registerHandlers=function(t){var e="";if(!b(t,function(t,n){var r=t instanceof I;return r||(e=n),r}))throw new Error(e+" is not valid state handler.");P=C({},P,t)},t.removeHandler=function(t){P=c(P,t)},t.HandlerResponse=x,t.StreamStore=E,t.StateHandler=I,t.MethodInvocation=S,t.intent=function(t){function e(e){for(var n in e)this[n]=e[n];t.call(this,e)}return e.prototype=t.prototype,e},t.Intent=M,t.isDefined=o,t.assign=i,t.extend=s,t.omit=c,t.forIn=p,t.isObject=u,t.isArray=a,t.isRegExp=function(t){return"RegExp"===w(t)},t.filter=l,t.map=h,t.some=f,t.every=b,t.mapValues=d,t.clone=v,t.symbol=y,t.Provisioning=W,t}({},React,PropTypes,Rx);
